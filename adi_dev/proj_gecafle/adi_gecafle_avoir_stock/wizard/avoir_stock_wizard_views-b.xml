<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- H√©ritage de la vue du wizard d'avoir express -->
    <record id="view_gecafle_avoir_express_wizard_form_inherit_stock" model="ir.ui.view">
        <field name="name">gecafle.avoir.client.wizard.form.inherit.stock</field>
        <field name="model">gecafle.avoir.client.wizard</field>
        <field name="inherit_id" ref="adi_gecafle_avoir_automation.view_gecafle_avoir_express_wizard_form"/>
        <field name="arch" type="xml">

            <!-- Ajouter le toggle apr√®s le type d'avoir -->
            <xpath expr="//field[@name='type_avoir']" position="after">
                <field name="mode_stock_detail"
                       widget="boolean_toggle"
                       invisible="type_avoir == 'consigne'"
                       string="üì¶ Avoir sur stock d√©taill√©"/>

            </xpath>

            <!-- Modifier l'affichage du montant -->
            <xpath expr="//field[@name='montant_avoir']" position="replace">
                <field name="montant_avoir"
                       invisible="mode_stock_detail"
                       required="not mode_stock_detail"/>
                <field name="montant_calcule"
                       invisible="not mode_stock_detail"
                       readonly="1"
                       widget="monetary"
                       string="Montant calcul√©"
                       class="text-success font-weight-bold"/>
            </xpath>

            <!-- Ajouter la section des produits APR√àS le groupe principal -->
            <xpath expr="//group[last()]" position="after">
                <!-- Section de s√©lection des produits -->
                 <!-- Options de gestion du retour-->
                <group invisible="not mode_stock_detail" col="4">


                    <group colspan="2">
                        <field name="gerer_retour_stock" widget="boolean_toggle"/>
                    </group>


                    <group colspan="2" invisible="not gerer_retour_stock">
                        <field name="type_retour" widget="radio_button"/>
                    </group>
                </group>

                <separator string="üì¶ S√©lection des produits √† retourner"
                           invisible="not mode_stock_detail"/>

                <field name="line_ids"
                       nolabel="1"
                       invisible="not mode_stock_detail">
                    <tree editable="bottom"
                          create="false"
                          delete="false"
                          decoration-success="inclure"
                          decoration-muted="not inclure">
                        <field name="wizard_id" invisible="1" optional="hide"/>
                        <field name="detail_vente_id" invisible="1" optional="hide"/>
                        <field name="currency_id" invisible="1" optional="hide"/>
                        <field name="inclure" widget="boolean_toggle" string=""/>
                        <field name="produit_id" string="Produit" readonly="1"/>
                        <field name="reception_num" string="N¬∞Rec" readonly="1"/>
                        <field name="producteur_id" readonly="1"/>
                        <field name="qualite_id" readonly="1" optional="show"/>
                        <field name="type_colis_id" readonly="1" optional="show"/>
                        <field name="nombre_colis_vendu" readonly="1" string="Nb vendus"/>
                        <field name="nombre_colis_retour"
                               string="Nb retour"
                               readonly="not inclure"/>
                        <field name="qte_vendue" readonly="1" string="Qt√© vendue (kg)"/>
                        <field name="qte_retour"
                               required="inclure"
                               readonly="not inclure"
                               string="Qt√© retour (kg)"/>
                        <field name="prix_unitaire"
                               readonly="1"
                               widget="monetary"
                               optional="hide"/>
                        <field name="montant_total"
                               widget="monetary"
                               sum="Total"
                               readonly="1"/>
                    </tree>
                </field>






                <!-- Messages d'aide -->
                <div class="alert alert-info mt-3"
                     invisible="not mode_stock_detail or line_ids">
                    <i class="fa fa-info-circle"/>
                    Les produits de la vente sont charg√©s automatiquement.
                    Cochez les produits √† retourner et ajustez les quantit√©s.
                </div>

                <div class="alert alert-warning mt-3"
                     invisible="not mode_stock_detail or montant_calcule > 0">
                    <i class="fa fa-warning"/>
                    S√©lectionnez au moins un produit (toggle) et d√©finissez sa quantit√© de retour.
                </div>

                <div class="alert alert-success mt-3"
                     invisible="not mode_stock_detail or montant_calcule == 0">
                    <i class="fa fa-check"/>
                    Pr√™t √† cr√©er l'avoir avec un montant de <strong><field name="montant_calcule" nolabel="1"/></strong>
                </div>
            </xpath>
        </field>
    </record>
</odoo>
