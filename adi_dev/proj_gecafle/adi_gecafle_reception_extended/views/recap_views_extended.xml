<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vue formulaire hÃ©ritÃ©e pour le rÃ©cap -->
    <record id="view_gecafle_reception_recap_form_inherit_extended" model="ir.ui.view">
        <field name="name">gecafle.reception.recap.form.inherit.extended</field>
        <field name="model">gecafle.reception.recap</field>
        <field name="inherit_id" ref="adi_gecafle_ventes.view_gecafle_reception_recap_form"/>
        <field name="priority">99</field>
        <field name="arch" type="xml">

            <!-- Ajouter le bouton wizard d'impression avancÃ©e dans le header -->
            <xpath expr="//header/button[@name='action_validate']" position="after">
                <button name="%(adi_gecafle_reception_extended.action_bordereau_print_wizard)d"
                        string="ðŸ–¨ï¸ Imprimer Bordereau AvancÃ©"
                        type="action"
                        class="btn-info"
                        icon="fa-print"
                        context="{'default_recap_id': id}"/>
                <button name="%(adi_gecafle_reception_extended.action_report_bordereau_ab_fr)d"
                        string="Bordereau A,B (FR)"
                        type="action"
                        class="btn-secondary"
                        icon="fa-print"/>
                <button name="%(adi_gecafle_reception_extended.action_report_bordereau_ab_ar)d"
                        string="ÙƒØ´Ù Ø£ØŒØ¨"
                        type="action"
                        class="btn-secondary"
                        icon="fa-print"/>
            </xpath>

            <!-- Ajouter l'onglet DÃ©tails Financiers -->
            <xpath expr="//page[@name='sale_lines']" position="after">
                <page string="ðŸ“Š DÃ©tails Financiers" name="financial_details">

                    <!-- Section 1: Vue d'ensemble -->
                    <group string="ðŸ“ˆ Montants Principaux" col="4">
                        <field name="total_ventes" widget="monetary"/>
                        <field name="total_commission" widget="monetary"/>
                        <field name="montant_total_emballage_achete"
                               widget="monetary"
                               readonly="1"/>
                    </group>

                    <!-- Section 2: Avances et paiements -->
                    <group string="ðŸ’° Paiements EnregistrÃ©s (Acomptes)" col="4"
                           class="alert alert-warning">
                        <field name="avance_producteur"
                               widget="monetary"
                               readonly="1"
                               invisible="avance_producteur == 0"
                               help="Avance versÃ©e au producteur"/>
                        <field name="transport"
                               widget="monetary"
                               readonly="1"
                               invisible="transport == 0"
                               help="Frais de transport payÃ©s"/>
                        <field name="paiement_emballage"
                               widget="monetary"
                               readonly="1"
                               invisible="paiement_emballage == 0"
                               help="Paiement emballage enregistrÃ©"/>
                    </group>

                    <!-- Tableau rÃ©capitulatif dÃ©taillÃ© -->
                    <group string="ðŸ“‹ Calcul DÃ©taillÃ© du Net Ã  Payer" col="2">
                        <group string="Total des ventes">
                            <field name="total_ventes" widget="monetary" readonly="1"/>
                        </group>
                        <group string="Emballages AchetÃ©s (+)" invisible="montant_total_emballage_achete == 0">
                            <field name="montant_total_emballage_achete"
                                   widget="monetary"
                                   readonly="1"
                                   class="text-success"/>
                        </group>
                        <group string="Total commission">
                            <field name="total_commission"
                                   widget="monetary"
                                   readonly="1"/>
                        </group>
                        <group string="Avance Producteur (-)" invisible="avance_producteur == 0">
                            <field name="avance_producteur"
                                   widget="monetary"
                                   readonly="1"
                                   class="text-danger"/>
                        </group>
                        <group string="Transport (-)" invisible="transport == 0">
                            <field name="transport"
                                   widget="monetary"
                                   readonly="1"
                                   class="text-danger"/>
                        </group>
                        <separator colspan="2"/>
                        <group string="SOLDE FOURNISSEUR" class="oe_subtotal_footer">
                            <field name="solde_fournisseur"
                                   widget="monetary"
                                   readonly="1"
                                   class="oe_subtotal_footer_separator"
                                   style="font-size: 1.3em;"/>
                        </group>
                        <group string="Net Ã  Payer (Facture)" class="text-muted">
                            <field name="net_a_payer"
                                   widget="monetary"
                                   readonly="1"/>
                        </group>
                    </group>

                </page>
            </xpath>

        </field>
    </record>
</odoo>
