<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_vente_reset_wizard_form" model="ir.ui.view">
        <field name="name">gecafle.vente.reset.wizard.form</field>
        <field name="model">gecafle.vente.reset.wizard</field>
        <field name="arch" type="xml">
            <form string="Remise en brouillon de la vente">
                <group>
                    <field name="vente_id" readonly="1"/>
                    <field name="has_invoice" invisible="1"/>
                    <field name="has_payments" invisible="1"/>
                    <field name="has_treasury_operations" invisible="1"/>
                </group>

                <!-- Alerte si paiements relevés -->
                <div class="alert alert-danger" invisible="not has_treasury_operations">
                    <strong>⚠️ Attention !</strong>
                    <p>Des paiements ont été relevés en caisse. La remise en brouillon est impossible.</p>
                    <p>Veuillez créer un avoir client à la place.</p>
                </div>

                <!-- Alerte si facture/paiements -->
                <div class="alert alert-warning" invisible="has_treasury_operations or (not has_invoice and not has_payments)">
                    <strong>⚠️ Cette vente contient :</strong>
                    <ul>
                        <li invisible="not has_invoice">✓ Une facture comptabilisée</li>
                        <li invisible="not has_payments">✓ Des paiements enregistrés</li>
                    </ul>
                    <p>Ces éléments seront supprimés si vous continuez.</p>
                </div>

                <!-- Détails des paiements -->
                <group string="Détails des paiements" invisible="not has_payments">
                    <field name="payment_info" readonly="1" nolabel="1"/>
                </group>

                <!-- Confirmation -->
                <group invisible="has_treasury_operations">
                    <field name="confirmation" widget="boolean_toggle"/>
                </group>

                <footer>
                    <button name="action_confirm_reset"
                            string="Confirmer la remise en brouillon"
                            type="object"
                            class="btn-danger"
                            invisible="has_treasury_operations"
                            confirm="Êtes-vous sûr? Cette action supprimera la facture et les paiements non relevés."/>
                    <button string="Annuler" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>
</odoo>
